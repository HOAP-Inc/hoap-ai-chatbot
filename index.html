<!doctype html>
<html lang='ja'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>HOAP サイト用チャット</title>
  <style>
    :root {
      --z: 2147483000;
      --radius: 16px;
      --shadow: 0 8px 24px rgba(0,0,0,.18);
      --bg: #ffffff;
      /* ピンク→紫（見やすく適度に濃い） */
      --grad1: #f9a8d4; /* pink-300 */
      --grad2: #d8b4fe; /* purple-300 */
      --grad3: #c4b5fd; /* violet-300 */
    }
    * { box-sizing: border-box; }

    .hoap-chat-launcher {
      position: fixed; right: 20px; bottom: 20px; z-index: var(--z);
      width: 64px; height: 64px; border-radius: 999px; border: none; cursor: pointer;
      background: linear-gradient(135deg, var(--grad1), var(--grad2), var(--grad3));
      color: #fff; font-size: 24px; display: grid; place-items: center;
      box-shadow: var(--shadow);
    }

    .hoap-chat {
      position: fixed; right: 20px; bottom: 100px; z-index: var(--z);
      width: 360px; max-width: calc(100vw - 40px);
      background: var(--bg); border-radius: var(--radius); box-shadow: var(--shadow);
      border: 1px solid #e5e7eb; isolation: isolate;
      display: none; flex-direction: column; overflow: hidden;
    }
    .hoap-chat.open { display: flex; }

    .hoap-chat-header {
      padding: 12px 14px;
      background: linear-gradient(135deg, var(--grad1), var(--grad2), var(--grad3));
      color: #fff; display: flex; align-items: center; gap: 10px;
    }
    .hoap-chat-header .title { font-weight: 700; font-size: 14px; }
    .hoap-chat-header .sub { font-size: 12px; opacity: .9; }
    .hoap-chat-close { margin-left: auto; background: transparent; color: #fff; border: none; font-size: 18px; cursor: pointer; }

    /* 本文（吹き出し=前景 / ほーぷちゃん=中景） */
    .hoap-chat-body {
      padding: 12px; height: 420px; overflow-y: auto; background: #fafafa;
      position: relative; z-index: 0; /* 背景層 */
      padding-bottom: calc(12px + var(--uiH, 0px));
    }

    .msg { display: flex; gap: 8px; margin-bottom: 10px; position: relative; z-index: 2; }
    .msg.user { justify-content: flex-end; }
    .bubble { padding: 10px 12px; border-radius: 14px; max-width: 80%; line-height: 1.4; font-size: 14px; }
    .msg.bot .bubble { background: #fff; border: 1px solid #e5e7eb; }
    .msg.user .bubble { background: linear-gradient(135deg, var(--grad1), var(--grad2), var(--grad3)); color: #fff; }

    .quick {
      display: flex; flex-wrap: wrap; gap: 8px; padding: 10px 12px;
      border-top: 1px solid #e5e7eb; background: #fff;
    }
    .quick button {
      border: 1px solid #e5e7eb; background: #fff; border-radius: 999px;
      padding: 6px 10px; font-size: 12px; cursor: pointer;
    }

    .hoap-chat-input {
      display: flex; gap: 8px; padding: 10px; border-top: 1px solid #e5e7eb; background: #fff;
    }
    .hoap-chat-input input {
      flex: 1; border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; font-size: 14px;
    }
    .hoap-chat-input button {
      background: linear-gradient(135deg, var(--grad1), var(--grad2), var(--grad3));
      color: #fff; border: none; padding: 0 14px; border-radius: 10px; cursor: pointer;
    }

    /* ★ ほーぷちゃん：本文内で右下固定（スクロールに連動しない）、吹き出しの後ろ */
.mascot{
  position: absolute;    /* 基準は .hoap-chat-body */
  right: 8px;
  bottom: calc(8px + var(--uiH, 0px) - var(--down, 0px));
  width: min(78%, 300px);
  pointer-events: none;
  z-index: 1;            /* 背景(0) < ほーぷ(1) < 吹き出し(2) */
  filter: drop-shadow(0 10px 24px rgba(0,0,0,.22));
  opacity: .98;

  /* スクロール打消し。JSで --scrollY を更新 */
  transform: translateY(var(--scrollY, 0px));
}

.mascot-sprite{
  display: block; width: 100%; height: auto;
  animation: floaty 4.8s ease-in-out infinite;
}

@keyframes floaty {
  0%   { transform: translateY(0) rotate(0.4deg); }
  50%  { transform: translateY(-8px) rotate(-0.4deg); }
  100% { transform: translateY(0) rotate(0.4deg); }
}

@media (prefers-reduced-motion: reduce) {
  .mascot-sprite { animation: none; }
}
  </style>
</head>
<body>
  <button class='hoap-chat-launcher' aria-label='チャットを開く'>💬</button>

  <div class='hoap-chat' role='dialog' aria-label='HOAP サイトチャット'>
    <div class='hoap-chat-header'>
      <div>
        <div class='title'>HOAP-chan</div>
        <div class='sub'>医療・歯科・介護業界特化 採用支援</div>
      </div>
      <button class='hoap-chat-close' aria-label='閉じる'>×</button>
    </div>

    <!-- ★ ほーぷちゃんは本文(.hoap-chat-body)の“中”に置く -->
    <!-- ここを置き換え -->
<div class='hoap-chat-body' id='chatBody'>
  <div class='mascot' aria-hidden='true'>
    <img class='mascot-sprite' src='hoap-basic.png' alt='HOAP-chan'>
  </div>
</div>

    <div class='quick' id='quickArea'>
      <button data-intent='about'>サービス概要</button>
      <button data-intent='trend'>採用トレンド</button>
      <button data-intent='challenge'>採用課題</button>
      <button data-intent='solution'>HOAPの解決法</button>
      <button data-intent='feature'>支援の特徴</button>
      <button data-intent='insta'>Instagram運用</button>
      <button data-intent='cases'>事例紹介</button>
      <button data-intent='price'>料金</button>
      <button data-intent='flow'>導入フロー</button>
      <button data-intent='contact'>問い合わせ</button>
    </div>

    <div class='hoap-chat-input'>
      <input id='chatInput' type='text' placeholder='質問を入力して送信'>
      <button id='sendBtn'>送信</button>
    </div>
  </div>

  <script>
    // 要素
    const bodyEl   = document.getElementById('chatBody');
    const inputEl  = document.getElementById('chatInput');
    const sendBtn  = document.getElementById('sendBtn');
    const quickEl  = document.getElementById('quickArea');

    // 下のボタン群と入力欄の高さに合わせて、ほーぷちゃんの下端を持ち上げる
function placeMascot() {
  const quickH = document.querySelector('.quick')?.offsetHeight || 0;
  const inputH = document.querySelector('.hoap-chat-input')?.offsetHeight || 0;
  const uiH = quickH + inputH;  // 下部UI合計
  bodyEl.style.setProperty('--uiH', uiH + 'px');   // ← これだけでOK
  // 追加：下げ量。
  bodyEl.style.setProperty('--down', Math.max(0, quickH - 45) + 'px');
}
    // マスコット固定用
function syncMascotWithScroll(){
  const mascot = document.querySelector('.mascot');
  if(!mascot) return;
  // スクロール量ぶんだけ下向きに動かして、見た目を固定
  mascot.style.setProperty('--scrollY', bodyEl.scrollTop + 'px');
}

    const launcher = document.querySelector('.hoap-chat-launcher');
    const dialog   = document.querySelector('.hoap-chat');
    const closeBtn = document.querySelector('.hoap-chat-close');

    // KB
    const KB = {
      about: 'HOAPは医療・歯科・介護業界に特化した採用支援サービスを提供しているよ。求人媒体＋SNS運用を代行し、手間なく欲しい人材から応募を集めるのが得意なんだ！',
      trend: '求職者は応募前にSNSで情報収集する時代。求職者の8割がSNSで気になる会社を検索し、職場の雰囲気や人間関係を確認してから応募するんだ。',
      challenge: 'よく相談される課題は「応募が来ない」「時間がない」「離職が多い」。診療や訪問に追われ、採用に手が回らない経営者も多いんだ。',
      solution: 'HOAPは業界特化のノウハウで応募を集め、媒体の運用・スカウト・面接日調整、採用広報のSNS運用など実務まで代行しているよ。経営者や事務スタッフはコア業務に専念できるんだ！',
      feature: '特徴は3つ。①欲しい人材像を明確化 ②媒体運用やスカウト送付を代行 ③毎月データ分析と改善提案',
      insta: 'Instagram運用支援では、他社との差別化×求職者に共感される投稿を設計し、ファン化を狙うよ。お客様は写真の提供とアンケートの回答、投稿前のチェックだけでいいんだ！',
      cases: '事例① 兵庫県の訪問看護ステーション様では人事部門をアウトソーシングして応募が増加。事例②千葉県の介護事業所様ではなんと応募数が2.5倍に。　事例③東京都の訪問看護ステーション様では求職者からDMで応募が来たり面接で「インスタを見て応募を決めました」という声もあるんだ。',
      price: '採用支援は月額10万円〜（求人数・期間により変動）。Instagram運用支援は月額15万円。初期費用は各10万円で提供しているよ！',
      flow: '導入フローは ①無料相談 ②契約 ③キックオフMTG ④支援開始。最短3営業日で着手可能だよ！',
      contact: 'お問い合わせはメール（info@hoap-inc.jp）、SNS DMでもOK◎このChatに連絡先を教えてもらえれば担当者から折り返すこともできるよ。'
    };

    // 吹き出し
    function addMsg(side, text) {
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + side;
      const bub = document.createElement('div');
      bub.className = 'bubble';
      bub.textContent = text;
      wrap.appendChild(bub);
      bodyEl.appendChild(wrap);
      bodyEl.scrollTop = bodyEl.scrollHeight;
      placeMascot();
      syncMascotWithScroll();
    }
    const botSay  = (t)=>addMsg('bot', t);
    const userSay = (t)=>addMsg('user', t);

    function answer(intent) {
      const btn = quickEl.querySelector(`[data-intent='${intent}']`);
      if (btn) userSay(btn.textContent);
      botSay(KB[intent] || '資料にない質問だよ。別のボタンを押してみて！');
    }

    function handleInput() {
      const text = inputEl.value.trim();
      if (!text) return;
      userSay(text);
      inputEl.value = '';
      botSay('ボタンで選ぶとすぐ答えるよ！');
    }

    sendBtn.addEventListener('click', handleInput);
    inputEl.addEventListener('keydown', e => { if (e.key === 'Enter') handleInput(); });
    quickEl.addEventListener('click', e => {
      const btn = e.target.closest('button'); if (!btn) return;
      answer(btn.dataset.intent);
    });

    // 開閉
    function openChat() {
      dialog.classList.add('open');
      if (!bodyEl.dataset.welcomed) {
        botSay('こんにちは！ほーぷちゃんだよ。気になるところをタップしてね！');
        bodyEl.dataset.welcomed = '1';
      }
      placeMascot();
      syncMascotWithScroll();
      inputEl.focus();
    }
    function closeChat() { dialog.classList.remove('open'); }

    launcher.addEventListener('click', openChat);
    closeBtn.addEventListener('click', closeChat);
    window.addEventListener('resize', placeMascot);
    bodyEl.addEventListener('scroll', syncMascotWithScroll);
  </script>
</body>
</html>
